# モバイルデバイスルールの作成

> モバイルデバイスルールは、Liferay Mobile Device Detection Liteが7.3で廃止予定になったため、Liferay7.2以前でのみ使用できます。

前提条件として、Liferay マーケットプレイスから [Liferay Mobile Device Detection Lite (LMDD)](https://web.liferay.com/marketplace/-/mp/application/92831494) アプリをインストールする必要があります。 このアプリは、どのモバイルデバイスがアクセスしているかを検出するために必要なデバイス検出データベースを提供します。

## モバイルデバイス種別の作成

モバイルデバイス種別は、デバイスのタイプに基づいたモバイルデバイスアクションのグループです。 [モバイルデバイスアクション](#adding-mobile-device-actions) を作成する前に、モバイルデバイス種別を作成します。 たとえば、すべてのAndroidデバイスのグループを作成します。LiferayがAndroidデバイスを検出すると、訪問者をモバイル対応のページにリダイレクトできます。

モバイルデバイス種別を作成するには、

1. 目的のサイトに移動します。
1. （![Menu](../../../images/icon-menu.png)）アイコンをクリックします。
1. *［設定］* &rarr; *［モバイルデバイスファミリー］*に移動します。
1. *追加* ボタン（![Add Family](../../../images/icon-add.png)）をクリックして、*［New Device Family］*を追加します。
1. *名前*と*説明*を入力します。
1. *［Save］* をクリックします。

［モバイルデバイスファミリー］ページには、定義された種別が一覧表示されます。

![ルールを作成できるように、モバイルデバイス種別を作成します。](./creating-mobile-device-rules/images/01.png)

すべてのサイトに種別を追加するには、サイトセレクター（![Go to Site](../../../images/icon-compass.png)）&rarr; *［マイサイト］* &rarr; *［グローバル］*の順にクリックしてグローバルサイトに移動し、新規デバイス種別を追加します。

種別に対して定義されたルールは、特定のサイトまたはページに対して選択された種別の優先順位とともに、特定のリクエストに適用される種別のアクションを決定します。 新しいルールでは、オペレーティングシステム、ルールタイプ、物理スクリーンサイズ、および画面の解像度を指定できます。 アクションを実行するデバイスを分類するために、必要な数のルールを種別に追加できます。

1. *［モバイルデバイスファミリー］*ページで、モバイルデバイス種別の名前をクリックします。 ［判別ルール］ページが表示されます。
1. *追加*ボタン（![Add Classification Rule](../../../images/icon-add.png)）をクリックして新しいルールを追加します。
1. *名前*と*説明*を入力します。
1. このルールにしたい分類を*［Operating System and Type］*、*［Physical Screen Size］*、および*［Screen Resolution］*から選択します。

    ![モバイルデバイスルールを追加します。](creating-mobile-device-rules/images/02.png)

1. *［Save］* をクリックします。

## モバイルデバイスルールの適用

種別は、それぞれの構成ページからサイト、個々のページ、またはページセットに追加できます。 ページセットに対してそれを行うには、

1. サイトの*［サイトビルダー］* &rarr; *［Pages］*に移動します。
1. パブリックページの（![Configure](../../../images/icon-cog.png)）アイコンをクリックします。
1. *［詳細設定］* タブをクリックします。
1. *［モバイルデバイスルール］*セクションを展開します。
1. *［選択］*をクリックして種別の一覧を開きます。
1. 適用する種別を選択します。

    ![サイトのモバイルデバイスルールを設定します。](./creating-mobile-device-rules/images/03.png)

1. 完了したら、*［保存］*をクリックします。

### ページにモバイルデバイスルールを適用する

親サイトからモバイルデバイスルールを継承するように各ページを構成することも、特定のページに異なるルールを適用することもできます。

特定のページにモバイルデバイスルールを設定するには、

1. サイトの*［サイトビルダー］* &rarr; *［Pages］*に移動します。
1. 目的のページの横にある![Options](../../../images/icon-options.png)アイコンをクリックして、*［構成］*をクリックします。
1. *［詳細設定］* タブをクリックします。
1. *［Mobile Device Rules］*セクションを展開します。
1. トグルを*［NO］*にスライドさせて、親サイトとは別のモバイルデバイスルールを選択します。
1. *［Select］*をクリックして種別の一覧を開きます。
1. 適用する種別を選択します。

    ![親サイトとは異なるモバイルデバイスルールをページで使用します。](./creating-mobile-device-rules/images/04.png)

1. 完了したら、*［Save］*をクリックします。

## モバイルデバイスアクションの追加

いくつかのモバイルデバイスファミリーを作成し、それらにいくつかのルールを追加したら、モバイルデバイスアクションを追加します。 種別に定義されたこれらのアクションは、デバイスが検出され、種別が適用されることが判明したときに、リクエストに何が起こるかを決定します。

```{tip}
セグメンテーションとパーソナライズには、ユーザーが特定のデバイス種別を使用してコンテンツにアクセスしているかどうかを評価する*デバイス*ルールがあります。 このルールは、モバイルデバイスファミリーアプリと統合されています。
```

モバイルデバイスアクションをページセットまたは特定のページに追加できます。

サイトのモバイルデバイスルールにアクションを追加するには、

1. Liferayゲストサイトの*［サイト管理］*メニューを開きます。
1. *［サイトビルダー］* &rarr; *［Pages］*の順にクリックします。
1. *［Public Pages］*の横にある（![Gear icon](../../../images/icon-cog.png)）アイコンをクリックします。
1. *［詳細設定］* タブをクリックします。
1. *［モバイルデバイスルール］*セクションを展開します。
1. アクションを追加するデバイス種別の横にある*オプション* （![Options](../../../images/icon-actions.png)）&rarr; *［アクションを管理］*をクリックします。
1. *［アクションの追加］*をクリックします。
1. *名前*と*説明*を入力します。
1. *タイプ*を選択します（たとえば、*［Redirect to Site］*）。 タイプについては、次の [モバイルデバイスアクションのリファレンス](#mobile-device-actions-reference) を参照してください。
1. 訪問者がリダイレクトされる目的のサイトを選択します。
1. サイトのログインページを選択します。

    ![既存のモバイルデバイスルールにアクションを追加します。](./creating-mobile-device-rules/images/05.png)

1. 完了したら、*［Save］*をクリックします。

モバイルデバイスアクションがこのサイトに追加されました。

## モバイルデバイスアクションのリファレンス

モバイルデバイス種別に定義されたモバイルデバイスアクションは、デバイスが検出され、種別が適用されることが判明したときに、リクエストに何が起こるかを決定します。

デフォルトでは、モバイル種別用に設定できるアクションは4種類あります。

![モバイルデバイスアクションをサイト、ページセット、またはページに追加します。](./creating-mobile-device-rules/images/06.png)

| モバイルデバイスアクション      | 説明                                                                                                                                          |
|:------------------ |:------------------------------------------------------------------------------------------------------------------------------------------- |
| **レイアウトテンプレートの変更** | モバイルデバイスに配信されるページでのポートレットの配置方法を変更します。 たとえば、複雑なレイアウトのページでは、モバイルデバイスが検出された場合、標準のレイアウトをサポートするのに十分な解像度が理論的に高い場合でも、より単純なテンプレートに自動的に切り替えることができます。 |
| **テーマの変更**         | さまざまなモバイルデバイスファミリーの特定のテーマを選択します。 デバイスがページにヒットしたときに自動的に適用されるサイトのテーマのモバイルバージョンが必要になります。                                                       |
| **URLリダイレクト**      | モバイルユーザーを任意のURLに送信します。 これは、モバイルユーザーをモバイルアプリのダウンロードまたはページのモバイルバージョンに誘導するために使用できます。                                                           |
| **サイトリダイレクト**      | モバイルユーザーをポータル上の別のサイトに送信します。 場合によっては、モバイルコンテンツをサイトのミラーリング上に作成することもできます。                                                                      |

```{tip}
Liferayは、応答性が高く、アクセスする可能性のあるすべてのデバイスに適応するように一から設計されました。 新しいテーマを作成したり、レイアウトテンプレートを強制的に変更したりする前に、サイトが追加設定なしでどのように動作するかをテストする必要があります。 URLリダイレクトなどの特定の機能は、不適切に使用すると混乱を招き、挫折感を引き起こす可能性があります。
```

## 追加情報

* [レスポンシブサイトの構築](./building-a-responsive-site.md)
